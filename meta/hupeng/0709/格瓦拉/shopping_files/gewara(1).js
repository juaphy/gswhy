var messageReplay=new Class({Extends:gewa.util.replay,options:{elements:"button",userheader:"",replayHttp:"",icon:""},element:"",values:"",initialize:function(a){this.parent(a)},commentPicture:function(a){this.pictureDialog=new Element("div",{styles:{width:940,height:540,background:"#000 url("+gewara.util.imgPath+"css/images/loading3.gif) center center no-repeat"}});this.pictureSrc=a.get("src").replace(/\b\/cw(\d){3}h(\d){3}\/\b/g,"/");this.param={};this.param.maxWidth=570;this.param.maxHeight=540;var b=this;this.param.imgParent=new Element("div",{styles:{width:570,height:540,"float":"left",overflow:"hidden",position:"relative"}}).inject(this.pictureDialog);Asset.image(this.pictureSrc,{styles:{position:"absolute"},onLoad:function(){b.pictureDialog.setStyle("background","#000");if(this.width>b.param.rateWidth||this.height>b.param.maxHeight){b.param.rateWidth=this.width/b.param.rateWidth;b.param.rateHeight=this.height/b.param.maxHeight;if(b.param.rateWidth>b.param.rateHeight){b.param.width=b.param.rateWidth;
b.param.height=this.height/b.param.rateWidth}else{b.param.width=this.width/b.param.rateHeight;b.param.height=b.param.maxHeight}}else{b.param.width=this.width;b.param.height=this.height}b.param.left=(b.param.maxWidth-b.param.width)/2;b.param.top=(b.param.maxHeight-b.param.height)/2;this.setStyles({left:b.param.left/2,top:b.param.top/2,width:this.width,height:this.height});new Fx.Morph(this,{duration:1000,link:"cancel",transition:Fx.Transitions.Sine.easeOut}).start({height:b.param.height,width:b.param.width,left:b.param.left,top:b.param.top});new Element("span",{styles:{display:"block",width:100,height:40,position:"absolute",background:"url(/css/home/iLike.png) no-repeat",right:20,bottom:20,cursor:"pointer"}}).addEvent("click",function(){var c=$("pictureId").value;collection(c,"picture")}).inject(b.param.imgParent);GewaraUtil.sendLoad(new Element("div",{styles:{width:350,height:500,padding:"20px 8px","float":"right",overflow:"hidden",background:"#fff","border-top-right-radius":"3px","border-bottom-right-radius":"3px"}}).inject(b.pictureDialog),GewaraUtil.basePath+"home/sns/ajax/getPictureCommentInfo.xhtml",{id:a.id},function(){b.optionsTarget=a;
b.optionsTarget.url=b.options.userheader;b.optionsTarget.element=b.pictureDialog.getElement("div[root=replay]");b.optionsTarget.id="img"+a.id;b.optionsTarget.httplink=b.options.replayHttp;b.optionsTarget.icon=b.options.icon;b.createMessageDialog(b.optionsTarget)}.bind(this));new Element("b",{text:"×",styles:{display:"inline-block","font-size":"12px","font-family":"sans-serif",position:"absolute",right:"10px",top:"10px",width:"14px",height:"14px","line-height":"14px","text-align":"center",border:"1px solid #d4d4d4","border-radius":"7px",cursor:"pointer",color:"#191919"}}).addEvents({mouseenter:function(){this.setStyles({"border-color":"#C03B0C",color:"#C03B0C"})},mouseleave:function(){this.setStyles({"border-color":"#d4d4d4",color:"#191919"})},click:function(){gewa.util.container.picture.dispose(["picture"],true);document.removeEvent("keydown",arguments.callee)}}).inject(b.pictureDialog)}}).inject(this.param.imgParent);gewa.util.maskContent("",this.pictureDialog,"",950,"picture","","#191919","#000000",true)
},replayAll:function(a){a.node=new Element("div",{styles:{display:"none"}}).inject(a.target.getParent(),"before");GewaraUtil.sendLoad(a.node,GewaraUtil.basePath+"home/sns/getReCommentList.xhtml",{commentid:a.target.id,index:6},function(b){a.target.getParent().dispose();a.node.reveal()})}});var modifyTextArea=new Class({initialize:function(c,b){if($(c)&&$(b)){var a=getMyConfig("tipsText");if(a&&a!=""){$("issueTips").innerHTML=a}var d=this;$(c).addEvents({focus:function(){$("issueTips").hide()},blur:function(){if(!$chk(this.value)){$("issueTips").show()}},keyup:function(e){if(e.key==="enter"){this.value=this.value.replace(/\n/g,"")}var f=140-this.value.length;$(b).innerHTML=f;if(f<0){$(b).setStyle("color","#ff0000")}else{$(b).setStyle("color","")}}})}}});gewa.util.getVideo=function(d){d=$(d);var b="";if(d.retrieve("key")==null){b=new Element("div");new Element("div",{text:"请添加.swf 格式视频地址：如(优酷网、土豆网、酷6网...)",styles:{width:"100%",height:"22px",overflow:"hidden","text-indent":"10px",background:"#eee","margin-bottom":"10px"}}).inject(b);
var a=new Element("input",{type:"text",styles:{"border-width":"1px","border-style":"solid","border-color":"#c2c2c2 #e6e6e6 #e6e6e6 #c2c2c2",padding:"3px",width:"320px",height:"18px",overflow:"hidden","border-radius":"3px"}}).inject(b);var c=new Element("span",{styles:{"margin-left":"10px",display:"inline","float":"left"}}).hide().inject(new Element("div",{styles:{"margin-top":"10px"}}).inject(b));new Element("span",{text:"添加"}).inject(new Element("a",{href:"#","class":"button minBt redBt",styles:{"float":"left"}}).addEvent("click",function(f){f.preventDefault();var g=this;checkLogin(true,function(){var h=GewaraUtil.isVideoURL(a.value.trim());c.show();if(h){g.hide();c.set("text","正在验证链接, 请等待...");var e=false;GewaraUtil.sendRequest(GewaraUtil.basePath+"micro/isConnect.xhtml",{url:a.value.trim()},function(i){if(i.success){if($("bodyForm").retrieve("video")==null){var j=new Element("input",{type:"hidden",name:"video",id:"video",value:a.value.trim()}).inject("bodyForm");$("replycontent").value=$("replycontent").value+"分享视频";
$("bodyForm").store("video",j);g.getElement("span").set("text","修改")}else{$("bodyForm").retrieve("video").value=a.value.trim()}c.set("html","")}else{c.set("text","您输入的视频链接地址无法识别！")}g.show()}.bind(g))}else{c.set("text","您输入的视频链接地址无法识别！");g.show()}})}).inject(c,"before"));d.store("key",b)}else{b=d.retrieve("key")}gewa.util.tips(d,b,360,"dailogVideo","down",function(){document.addEvent("click",function(h){var g=$(h.target),f=gewa.util.container.dailogVideo;if(g!=f.coreDialog&&!f.coreDialog.contains(g)&&g!=d&&!d.contains(g)){document.removeEvent("click",arguments.callee);f.dispose(["dailogVideo"],true)}})},"","0",false,0)};var getMyConfig=function(){var a=$("walaDynaScript");return function(c){var b=a.getAttribute(c);return b?b:""}}();gewa.util.ckeditor=function(){document.getElements("*[lang=default]").hide();if(!$("isCkeditor")){Asset.javascript(GewaraUtil.basePath+"ckeditor/ckeditor.js",{id:"isCkeditor",onLoad:function(){new OverText(new Element("input",{type:"text",name:"",alt:"在这里请输入标题..."}).inject(new Element("div",{"class":"modify_alt",role:"application"}).inject($("isModify").getFirst(),"after")));
var a=CKEDITOR.replace("replycontent",{customConfig:"/ckeditor/walaConfig.js?v=00000000000"});a.on("paste",function(d){if($chk(d.data.html)){var c=this.getData();var b=d.data.html;if(d.data.html.indexOf("data:image/")>0){gewa.util.alert("图片不能直接粘贴，请点击图像上传！",function(){this.setData(c)}.bind(this))}else{if((b.indexOf("&lt;script&gt;")>0||b.indexOf("<script>")>0)&&(b.indexOf("&lt;style&gt;")>0||b.indexOf("<style>")>0)){gewa.util.alert("粘贴非法数据，请在文本中过滤后再进行粘贴！",function(){this.setData(c)}.bind(this))}}}})}})}else{document.getElements("*[role=application]").show()}};gewa.util.swicth=function(a){a=$(a);if(a.retrieve("langth")==null){a.store("langth",true);a.addClass("langth");gewa.util.ckeditor();$("switch_notice").innerHTML="切回哇啦点这里！";if($$(".ui_wala_textArea")){$("replycontent").getParent("div").removeClass("ui_wala_textArea")}}else{a.store("langth",null);a.removeClass("langth");document.getElements("*[role=application]").hide();document.getElements("*[lang=default]").show().fade("in");$("switch_notice").innerHTML="长篇大论点这里！";
$("replycontent").getParent("div").addClass("ui_wala_textArea")}};function syscData(b,f,a,e){var c="",d=632;if(a=="sina"){c=new Element("iframe",{frameborder:0,scrolling:"no",height:"368",width:"600",src:b})}else{c=new Element("div",{styles:{width:"620px",height:window.ActiveXObject?"380px":"330px",overflow:"hidden"}});new Element("iframe",{frameborder:0,scrolling:"no",height:"850",width:"810",src:b,styles:{"margin-top":"-280px","margin-left":"-160px"}}).inject(c);d=650}gewa.util.maskContent("",c,"正在设置"+f+"的同步",d,"syscing")}var isBind=function(a){if(a.length!=0){var b=document.getElements("input[type=checkbox][title=新浪微博]");if(b.length>0){b.each(function(c){c.checked=true});gewa.util.isWbOpen=false}}if(gewa.util.container.syscing){gewa.util.container.syscing.dispose("syscing")}};gewa.util.DefaultBindModify=function(){gewa.util.isWbOpen=true;gewara.util.sendRequest(GewaraUtil.basePath+"ajax/member/synchroizaInfo.xhtml",{},function(a){if(a.success){if(a.appList){if(a.appList.contains("sina")){document.getElements("input[type=checkbox][title=新浪微博]").each(function(b){b.checked=true
});gewa.util.isWbOpen=false}}}});if($("replycontent")&&$("isFont")){new modifyTextArea("replycontent","isFont")}if($("Wb")){$("Wb").addEvent("click",function(){if(gewa.util.isWbOpen){this.checked="";checkLogin(true,function(){syscData(this.get("lang"),this.get("title"),"sina",this)}.bind(this))}})}if($("faceTags")){$("faceTags").addEvent("click",function(){new Icon().innerHTML(this,"replycontent")})}if($("walageneralmark")){new RatingGroup("walageneralmark",gewa.util.mymarks||0,gewaUtil.values.tag,gewaUtil.values.relatedid,marks||{})}};gewa.util.nodeBindWala=function(c){c=$(c);c.getElements(".ui_wala_original").addEvents({mouseenter:function(){this.addClass("hover")},mouseleave:function(){this.removeClass("hover")}});var a;c.getElements(".useful").addEvents({mouseenter:function(){a=this.get("text");this.set("text","赞同")},mouseleave:function(){this.set("text",a)},click:function(){var f=this;var e=this.id;checkLogin(true,function(){GewaraUtil.sendRequest(GewaraUtil.basePath+"activity/ajax/sns/memberSupport.xhtml",{type:"comment",relatedid:e},function(g){if(g.success){a=a.toInt()+1;
f.innerHTML=a}else{gewaUtil.alert(g.msg)}})})}});var b=new Icon(),d=new messageReplay({replayHttp:GewaraUtil.basePath,icon:b});c.getElements(".comment,.forwards").addEvent("click",function(i){i.preventDefault();var g={};g._this=this;g.element=this.getParent(".page_wala").getElement("div[root=replay]");g.element.removeClass("4");g.icon=b;var f=g.element.getElement("input[type=hidden]");var h=this.getParent(".page_replay_opt i");if(f&&((f.value=="f"&&this.hasClass("forwards"))||(f.value=="r"&&this.hasClass("comment")))){if(h){h.dispose()}g.element.addClass("none");f.value="h";return}g.callback=function(){if(h){h.dispose()}new Element("i",{html:"◆"}).inject(new Element("i",{html:"◆","class":"t"}).inject(this))}.bind(this);if(this.hasClass("comment")){if(this.retrieve("request")==null){this.store("request",true);gewara.util.sendLoad(g.element,GewaraUtil.basePath+"activity/ajax/sns/oldReCommentList.xhtml",{cid:this.id},function(e){g.element.getElements("button,.comment").addEvent("click",function(){g._this=this;
g.callback=null;gewa.util.walaOptions(g,d)});gewa.util.walaOptions(g,d)})}else{gewa.util.walaOptions(g,d)}}else{gewa.util.walaOptions(g,d)}});c.getElements("*[data-type=page-talk]").each(function(e){new gewa.util.toggleMoreContent(e)})};gewa.util.walaOptions=function(a,b){a.url=getMyConfig("userLogo");a.id=a._this.id;a.httplink="${basePath}";b.createMessageDialog(a)};gewa.util.toggleMoreContent=new Class({params:{callback:$empty},siwtch:true,initialize:function(a){this.node=$(a);this.node.setStyle("height",60);this.params.ny=60;this.params.cy=0;this.cearteMoreLink()},updateLinkText:function(){if(this.siwtch){this.params.dot.hide();this.params.a.innerHTML="&lt;&lt; 收起更多"}else{this.params.dot.setStyle("display","inline");this.params.a.innerHTML="展开更多 &gt;&gt;"}},cearteMoreLink:function(){this.clist=this.node.getChildren(":not(br)");this.filterNode=[];if(this.clist.length===0){this.node.store("html",this.node.innerHTML);this.node.innerHTML=this.node.innerHTML.substring(0,60);var a=this.node.getDimensions().y;
this.node.setStyle("height",a);this.params.ny=a}else{this.clist.each(function(c,b){this.params.cy=c.getDimensions().y+this.params.cy;if(this.params.cy>=this.params.ny-10){c.hide();this.filterNode.push(c)}if(b===this.clist.length-1){this.filterNode=new Elements(this.filterNode)}}.bind(this))}this.params.dot=new Element("span",{html:"...",styles:{"margin-right":"5px","font-family":"Lucida Console"}}).inject(this.node);this.params.a=new Element("a",{href:"javascript:void(0);",html:"展开更多&gt;&gt;","class":"ffst"}).addEvent("click",function(b){b.preventDefault();if(this.node.getDimensions().y==this.params.ny){this.node.setStyle("height","auto");if(this.clist.length===0){this.node.innerHTML=this.node.retrieve("html")}else{this.filterNode.show()}this.siwtch=true;this.updateLinkText()}else{this.node.setStyle("height",this.params.ny);if(this.clist.length===0){this.node.innerHTML=this.node.retrieve("html").substring(0,60)}else{this.filterNode.hide()}this.siwtch=false;this.updateLinkText()}this.params.dot.inject(this.node);
this.params.a.show().inject(this.node)}.bind(this)).inject(this.node)}});var isinitCatch=true;gewa.util.loadwalas=function(c){c=$(c);var d={},b={};if(!(gewaUtil.values.pages&&gewaUtil.values.pages==true)){if(isinitCatch&&gewa.util.pageNumber==0){d.el=new Element("div").inject(c)}else{d.el=new Element("div",{"data-content":"walalist"}).inject(c)}d.wait=$(c).retrieve("loading");if(!d.wait){d.wait=new Element("div",{"class":"ui_loading",styles:{"text-align":"center",cursor:"pointer"}}).addEvent("click",function(){if(getMyConfig("maxNumber")&&getMyConfig("maxNumber")<=gewa.util.pageNumber){this.removeEvents("click");if(getMyConfig("outUrl")&&getMyConfig("maxNumber")-1<=gewa.util.pageNumber){this.set("html",'<a href="'+getMyConfig("outUrl")+'" target="_blank">'+this.innerHTML+"</a>");GewaraUtil.openwin(getMyConfig("outUrl"),"_blank")}return}gewa.util.loadwalas(c)}).inject(c);$(c).store("loading",d.wait)}else{d.wait.inject(c)}}else{if(gewa.util.nodeDiv&&gewa.util.nodeDiv.getElement("div.ui_wala_comment")){d.el=gewa.util.nodeDiv.getElement("div.ui_wala_comment")
}else{gewa.util.nodeDiv=d.el=$(c)}}b=gewa.util.values?gewa.util.values:b;b.isWide=true;if(isinitCatch&&getMyConfig("isTicket")){b.isTicket=true}else{b.isTicket=false}b.pageNumber=gewa.util.pageNumber;d.type="哇啦";var a=(getMyConfig("maxNumber")&&getMyConfig("maxNumber")-1<=gewa.util.pageNumber)?true:false;d.text=a?"查看":"加载";if(d.wait){d.wait.innerHTML="加载"+d.type+"中..."}b.isShare=b.isShare==undefined?true:b.isShare;gewara.util.sendLoad(d.el,GewaraUtil.basePath+gewa.util.requestUrl,b,function(e){if(e.success){if(gewa.util.pageNumber==0&&isinitCatch){if(b.contPanel&&$(b.contPanel)&&b.isCount){$(b.contPanel).innerHTML="("+gewa.util.walaCount+")"}gewa.util.DefaultBindModify();if(getMyConfig("isTicket")&&$("flagTicket")){$("flagTicket").addEvent("click",function(){if(this.checked){gewa.util.values.flag="ticket"}else{gewa.util.values.flag=""}gewa.util.pageNumber=0;c.getElements("div[data-content=walalist]").dispose();c.getElements("div[data-first=walalist]").dispose();var h=$(c).retrieve("loading");
if(h){$(c).eliminate("loading");h.dispose()}gewa.util.loadwalas(c)})}}gewa.util.nodeBindWala(d.el);gewa.util.walaPhoto(d.el);gewa.util.pageNumber=gewa.util.pageNumber+1;gewa.util.values.issue=false;gewaUtil.myScroll=true;if(c.getChildren().length>3&&d.el.getElements("div").length==0){if(d.wait){d.wait.innerHTML=d.type+"已经全部加载！"}}else{if(c.getChildren().length>1&&d.el.getElements("div").length==0){if(d.wait){d.wait.innerHTML="没有更多"+d.type+"了！";d.wait.removeEvents("click")}}else{if(d.wait){if(gewaUtil.values.isCount&&gewaUtil.values.isCount==true&&gewa.util.walaCount&&gewa.util.walaCount>0){var g=gewa.util.walaCount;if(b.maxCount>0){g=gewa.util.walaCount-gewa.util.pageNumber*b.maxCount}d.wait.innerHTML="共"+g+"条"+d.type+"，点击"+d.text+"更多！";if(g<=0){d.wait.setStyle("opacity",0)}else{d.wait.setStyle("opacity",1)}}else{d.wait.innerHTML="加载更多"+d.type+"数据！";if(gewa.util.walaCount==0){d.wait.setStyle("opacity",0)}else{d.wait.setStyle("opacity",1)}}}}}if(gewaUtil.values.pages&&gewaUtil.values.pages==true){var f=d.el.getElements("div.ui_wala_page a");
if(f.length>0){f.addEvent("click",function(h){h.preventDefault();gewa.util.pageNumber=this.get("lang");gewa.util.loadwalas(d.el)})}}isinitCatch=false}else{if(d.wait){d.wait.innerHTML="没有更多"+d.type+"了！";d.wait.removeEvents("click")}}})};gewa.util.walaPhoto=function(b){b=$(b);var a=b.getElements(".ui_wala_Photos");if(a){a.each(function(c){resizePicture(c.getElements("img"),96,true,"","cw280h210")})}};gewa.util.init=function(){var a=$(document.body);gewa.util.myScroll=true;if(getMyConfig("isScroll")&&getMyConfig("isScroll")=="true"){gewa.util.loadwalas(getMyConfig("bindWala"));window.addEvent("scroll",function(){if(getMyConfig("maxNumber")&&getMyConfig("maxNumber")<=gewa.util.pageNumber){window.removeEvents("scroll");return}if(this.getScrollSize().y-this.getScroll().y-this.getSize().y<=20&&gewaUtil.myScroll){gewaUtil.myScroll=false;gewa.util.loadwalas(getMyConfig("bindWala"))}})}else{gewa.util.loadwalas(getMyConfig("bindWala"))}};gewa.util.deleteComment=function(a){gewaUtil.confirm("确认要删除吗?",function(){var c=GewaraUtil.basePath+"activity/ajax/sns/delComment.xhtml";
var b={id:a};GewaraUtil.sendRequest(c,b,function(d){if(d.success){document.getElement("dl.comment"+a).set("dissolve",{duration:"long",onComplete:function(){this.dispose()}.bind(document.getElement("dl.comment"+a))}).dissolve()}else{gewaUtil.alert(d.msg)}})})};gewa.util.submitMicro=function(){checkLogin(true,function(){gewa.util.getAndClearWalaElement();var d=GewaraUtil.basePath+"activity/ajax/sns/saveComent.xhtml";var a=$("replycontent"),h=a.value;if(!$chk(h)){a.highlight("#ffcc99","#fff");return}if(gewaUtil.values.isLongWala&&gewaUtil.values.isLongWala==true){if(h.length>3000){gewaUtil.alert("哇啦内容长度不可以超过3000个字！");return}}else{if(h.length>140){gewaUtil.alert("哇啦内容长度不可以超过140个字！");return}}var f="";var c="";if($("video")){f=$("video").value}if(document.getElement("input[name=bodypic]")){c=document.getElement("input[name=bodypic]").value}var b=gewaUtil.values;b.micrbody=h;b.video=f;b.pic=c;b.link=getMyConfig("link");if($chk(marks)){b.marks=marks.walageneralmark?marks.walageneralmark:0}var e=getMyConfig("bindWala");
var g=new Element("div").inject($(e).getElement("div.ui_wala_comment"),"top");GewaraUtil.sendLoad(g,d,b,function(i){if(i.success){gewa.util.nodeBindWala(g);gewa.util.walaPhoto(g);$("replycontent").value=""}else{gewaUtil.alert(i.json.msg)}},"","post")})};gewa.util.getAndClearWalaElement=function(){var b=$("replycontent");var a=new Element("div",{html:b.value});["script","link","style"].each(function(c){a.getElements(c).dispose()});_process(a);b.value=a.innerHTML;return a.innerHTML};var Slimbox;(function(){var X=0,Y,S,ac,J,I,P,Z,R,U=new Image(),T=new Image(),E,N,O,W,F,C,V,D,ab;window.addEvent("domready",function(){$(document.body).adopt($$([E=new Element("div",{id:"lbOverlay"}).addEvent("click",Q),N=new Element("div",{id:"lbCenter"}),C=new Element("div",{id:"lbBottomContainer"})]).setStyle("display","none"));O=new Element("div",{id:"lbImage"}).injectInside(N).adopt(W=new Element("a",{id:"lbPrevLink",href:"#"}).addEvent("click",aa),F=new Element("a",{id:"lbNextLink",href:"#"}).addEvent("click",K));V=new Element("div",{id:"lbBottom"}).injectInside(C).adopt(new Element("a",{id:"lbCloseLink",href:"#"}).addEvent("click",Q),D=new Element("div",{id:"lbCaption"}),ab=new Element("div",{id:"lbNumber"}),new Element("div",{styles:{clear:"both"}}));Z={overlay:new Fx.Tween(E,{property:"opacity",duration:500}).set(0),image:new Fx.Tween(O,{property:"opacity",duration:500,onComplete:ad}),bottom:new Fx.Tween(V,{property:"margin-top",duration:400})}});Slimbox={open:function(a,b,c){Y=$extend({loop:false,overlayOpacity:0.8,resizeDuration:400,resizeTransition:false,initialWidth:250,initialHeight:250,animateCaption:true,showCounter:true,counterText:"第{x}张，共{y}张"},c||{});
if(typeof a=="string"){a=[[a,b]];b=0}S=a;Y.loop=Y.loop&&(S.length>1);M();L(true);P=window.getScrollTop()+(window.getHeight()/15);Z.resize=new Fx.Morph(N,$extend({duration:Y.resizeDuration,onComplete:ad},Y.resizeTransition?{transition:Y.resizeTransition}:{}));N.setStyles({top:P,width:Y.initialWidth,height:Y.initialHeight,marginLeft:-(Y.initialWidth/2),display:""});Z.overlay.start(Y.overlayOpacity);X=1;return H(b)}};Element.implement({slimbox:function(b,a){$$(this).slimbox(b,a);return this}});Elements.implement({slimbox:function(d,a,b){a=a||function(e){return[e.href,e.title]};b=b||function(){return true};var c=this;c.removeEvents("click").addEvent("click",function(){var e=c.filter(b,this);return Slimbox.open(e.map(a),e.indexOf(this),d)});return c}});function M(){E.setStyles({top:window.getScrollTop(),height:window.getHeight()})}function L(b){["object",Browser.Engine.trident?"select":"embed"].forEach(function(c){Array.forEach(document.getElementsByTagName(c),function(d){if(b){d._slimbox=d.style.visibility
}d.style.visibility=b?"hidden":d._slimbox})});E.style.display=b?"":"none";var a=b?"addEvent":"removeEvent";window[a]("scroll",M)[a]("resize",M);document[a]("keydown",G)}function G(a){switch(a.code){case 27:case 88:case 67:Q();break;case 37:case 80:aa();break;case 39:case 78:K()}return false}function aa(){return H(J)}function K(){return H(I)}function H(a){if((X==1)&&(a>=0)){X=2;ac=a;J=((ac||!Y.loop)?ac:S.length)-1;I=ac+1;if(I==S.length){I=Y.loop?0:-1}$$(W,F,O,C).setStyle("display","none");Z.bottom.cancel().set(0);Z.image.set(0);N.className="lbLoading";R=new Image();R.onload=ad;R.src=S[a][0]}return false}function ad(){switch(X++){case 2:N.className="";O.setStyles({backgroundImage:"url("+S[ac][0]+")",display:""});$$(O,V).setStyle("width",R.width);$$(O,W,F).setStyle("height",R.height);D.set("html",S[ac][1]||"");ab.set("html",(Y.showCounter&&(S.length>1))?Y.counterText.replace(/{x}/,ac+1).replace(/{y}/,S.length):"");if(J>=0){U.src=S[J][0]}if(I>=0){T.src=S[I][0]}if(N.clientHeight!=O.offsetHeight){Z.resize.start({height:O.offsetHeight});
break}X++;case 3:if(N.clientWidth!=O.offsetWidth){Z.resize.start({width:O.offsetWidth,marginLeft:-O.offsetWidth/2});break}X++;case 4:C.setStyles({top:P+N.clientHeight,marginLeft:N.style.marginLeft,visibility:"hidden",display:""});Z.image.start(1);break;case 5:if(J>=0){W.style.display=""}if(I>=0){F.style.display=""}if(Y.animateCaption){Z.bottom.set(-V.offsetHeight).start(0)}C.style.visibility="";X=1}}function Q(){if(X){X=0;R.onload=$empty;for(var a in Z){Z[a].cancel()}$$(N,C).setStyle("display","none");Z.overlay.chain(L).start(0)}return false}})();Slimbox.scanPage=function(b){if(b){var c=new Element("div").setStyle("display","none").set("id","_hidDV").inject(document.body);GewaraUtil.sendLoad("_hidDV",gewara.util.basePath+"showSlimbox.xhtml",b,function(d){var g=$(document.body).getElements("a").filter(function(h){return h.rel&&h.rel.test(/^lightbox/i)&&h.getParent("div[id!=_hidDV]")});var f=$("_hidDV").getElements("a");$each(f,function(h){if(g.get("href").contains(h.get("href"))){h.set("show","false")
}});var e=$(document.body).getElements("a").filter(function(h){return h.rel&&h.rel.test(/^lightbox/i)&&(h.get("show")!="false")});$$(e).slimbox({},null,function(h){return(this==h)||((this.rel.length>8)&&(this.rel==h.rel))})})}else{var a=$(document.body).getElements("a").filter(function(d){return d.rel&&d.rel.test(/^lightbox/i)});$$(a).slimbox({},null,function(d){return(this==d)||((this.rel.length>8)&&(this.rel==d.rel))})}};