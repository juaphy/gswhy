!function(e){function t(e){if(void 0===e)return e;var t,n,r,o,a,i;for(r=e.length,n=0,t="";r>n;){if(o=255&e.charCodeAt(n++),n==r){t+=N.charAt(o>>2),t+=N.charAt((3&o)<<4),t+="==";break}if(a=e.charCodeAt(n++),n==r){t+=N.charAt(o>>2),t+=N.charAt((3&o)<<4|(240&a)>>4),t+=N.charAt((15&a)<<2),t+="=";break}i=e.charCodeAt(n++),t+=N.charAt(o>>2),t+=N.charAt((3&o)<<4|(240&a)>>4),t+=N.charAt((15&a)<<2|(192&i)>>6),t+=N.charAt(63&i)}return t}function n(e){for(var t in e)return!1;return!0}function r(){b=document.createElement("iframe"),b.id="__ToutiaoJSBridgeIframe_SetResult",b.style.display="none",document.documentElement.appendChild(b),E=document.createElement("iframe"),E.id="__ToutiaoJSBridgeIframe",E.style.display="none",document.documentElement.appendChild(E)}function o(){var e=JSON.stringify(k);return k=[],i("SCENE_FETCHQUEUE",e),e}function a(e){var t,n=e.__msg_type,r=e.__params,o=e.__event_id,a=e.__callback_id;return"callback"==n?(t={__err_code:"cb404"},"string"==typeof a&&"function"==typeof w[a]&&(t=w[a](r),delete w[a])):"event"==n&&(t={__err_code:"ev404"},"string"==typeof o&&"function"==typeof O[o]&&(t=O[o](r))),i("SCENE_HANDLEMSGFROMTT",JSON.stringify(t)),JSON.stringify(t)}function i(e,n){b.src=J+"private/setresult/"+e+"&"+t(I.encode(n))}function s(e,t,n){if(n=n||1,e&&"string"==typeof e){var r=(x++).toString();"function"==typeof t&&(w[r]=t);var o={JSSDK:n,func:e,params:{},__msg_type:"call",__callback_id:r};k.push(o),E.src=J+"dispatch_message/"}}var c,u,d,l,f,g,m,p,v=3,h=2e3,y=!1,_=!1,C=!1,A="advertiser",S=!1;_taq=_taq||[];var E,b,T=[],I={encode:function(e){e=e||"",e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);128>r?t+=String.fromCharCode(r):r>127&&2048>r?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t},decode:function(e){for(var t="",n=0,r=c1=c2=0;n<e.length;)r=e.charCodeAt(n),128>r?(t+=String.fromCharCode(r),n++):r>191&&224>r?(c2=e.charCodeAt(n+1),t+=String.fromCharCode((31&r)<<6|63&c2),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((15&r)<<12|(63&c2)<<6|63&c3),n+=3);return t}},N="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",k=[],x=1e3,w={},O={},J="bytedance://";e.ToutiaoJSBridge={_fetchQueue:o,_handleMessageFromToutiao:a};var P=function(e){var t="appInfo",r=navigator.userAgent.match(/JSSDK\/([\d.]+)/i),o=r?r[1]:1,a=e.error,i=e.success,c=e.fail;s(t,function(e){e=e||{};var t=e.code;n(e)?t=1:void 0==t&&(t=1),-1==t&&a&&a(e),0==t&&c&&c(e),1==t&&i&&i(e)},o)},Q={getUA:function(){var t={ipad:/ipad/gi.test(navigator.appVersion),iphone:/iphone/gi.test(navigator.appVersion),android:/android/gi.test(navigator.userAgent),nexusS:-1!=e.navigator.userAgent.indexOf(/Nexus\s*S/gi),miui:/MiuiBrowser/i.test(navigator.userAgent),huaWei:/huawei/i.test(navigator.userAgent),safari:/Safari/i.test(navigator.userAgent)&&/iPhone\sOS/.test(navigator.userAgent),weixin:/MicroMessenger/gi.test(navigator.userAgent),UC:/UC/i.test(navigator.userAgent)||/UC/i.test(navigator.appVersion),Baidu:/baidubrowser/i.test(navigator.userAgent)||/baiduboxapp/i.test(navigator.userAgent),QQ:/QQBrowser/i.test(navigator.userAgent)},n="";for(var r in t)t[r]&&(n=r);return n},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isToutiao:function(){var e="http://nativeapp.toutiao.com"==document.referrer||/(News|NewsSocial|Explore|NewsArticle)( |\/)(\d.\d.\d)/i.test(navigator.userAgent);return e},queryToJson:function(e){for(var t,n,r,o,a=e.substr(e.lastIndexOf("?")+1),i=a.split("&"),s=i.length,c={},u=0;s>u;u++)i[u]&&(o=i[u].split("="),t=o[0],n=o[1],r=c[t],"undefined"==typeof r?c[t]=n:this.isArray(r)?r.push(n):c[t]=[r,n]);return c},jsonToQuery:function(e){var t=[];e=e||{};var n=/^(?:string|boolean|number)/i;for(var r in e)e.hasOwnProperty(r)&&n.test(typeof e[r])&&t.push(r+"="+e[r]);return t.join("&")},extend:function(e,t){for(var n in t)e[n]=t[n]},getAdId:function(){var e=this.queryToJson(location.href),t=e.ad_id||e.aid||e.adId||"";return t},encodeParams:function(e){var t=[];e=e||{};var n=/^(?:string|boolean|number)/i;for(var r in e)if(e.hasOwnProperty(r)&&n.test(typeof e[r])){var o=decodeURIComponent(e[r]);t.push(encodeURIComponent(r)+"="+encodeURIComponent(o))}return t.join("&")},jsonp:function(t){if(t=t||{},!t.url||!t.callback)throw new Error("参数不合法");var n=("jsonp_"+Math.random()).replace(".",""),r=document.getElementsByTagName("head")[0];t.data[t.callback]=n;var o=this.encodeParams(t.data),a=document.createElement("script");r.appendChild(a),e[n]=function(o){r.removeChild(a),clearTimeout(a.timer),e[n]=null,t.success&&t.success(o)},a.src=t.url+"?"+o,t.time&&(a.timer=setTimeout(function(){e[n]=null,r.removeChild(a),t.fail&&t.fail({message:"超时"})},t.time))},addLoadEvent:function(t){var n=e.onload;e.onload="function"!=typeof e.onload?t:function(){n(),t()}}},q={getChildrenIndex:function(e){if(e.sourceIndex)return e.sourceIndex-e.parentNode.sourceIndex-1;for(var t=0;e=e.previousElementSibling;)t++;return t},getXPath:function(e){for(var t="";e.length;){var n=Array.prototype.pop.apply(e);n&&n.tagName&&"body"!=n.tagName.toLowerCase()&&"html"!=n.tagName.toLowerCase()&&(t+=n.tagName.toLowerCase()+this.getChildrenIndex(n)+(0==e.length?"":">"))}return t},getElementByAttr:function(e,t){if("string"==typeof e&&(e=document.getElementById(e)),e||(e=document),e.querySelectorAll){var n=e.querySelectorAll("["+t+"]");return n=Array.prototype.slice.call(n)}for(var r=e.getElementsByTagName("*"),o=r.length,a=0,i=[];o>a;a++){var s=r[a];s.getAttribute(t)&&i.push(s)}return i},getPerformanceObj:function(){if(!e.performance)return"";var t=performance.timing,n={lookupDomainTime:t.domainLookupEnd-t.domainLookupStart,connectTime:t.connectEnd-t.connectStart,requestTime:t.responseEnd-t.requestStart,initDomTreeTime:t.domInteractive-t.responseEnd,domReadyTiem:t.domComplete-t.domInteractive,loadEventTime:t.loadEventEnd-t.loadEventStart,loadTime:t.loadEventEnd-t.navigationStart};return n},getDomCount:function(){return document.getElementsByTagName("*").length},getElementParents:function(e){for(var t=[];e;)e=e.parentNode,e&&t.push(e);return t},delegate:function(t,n,r,o){function a(n){var a=/^\[(.*)\]$/,s=e.event?e.event:n,c=s.target||s.srcElement;if(a.test(r))for(var u=r.match(a)[1],d=q.getElementByAttr(t,u),l=c;l;){if(i.inElement(l,d)){o.call(c);break}l=l.parentNode}}if("string"==typeof t&&(t=document.getElementById(t)),t||(t=document),r&&"function"==typeof o){var i=this;t[n]=a}},inElement:function(e,t){for(var n=t.length,r=0;n>r;r++)if(e==t[r])return!0;return!1}},L={create:function(e,t){e||console.log("create error"),A="accounter",c=e,t=t},send:function(e){if(e.etype&&"pv"!=e.etype&&!e.target)return void console.log("error: no target param");var t={},n=this;for(var r in e)if("etype"==r)t.event_type=e[r];else if("target"==r){var o=n.getPosition(e[r]);Q.extend(t,o)}else t[r]=e[r];return T.length<v?void T.push(t):void this.consumeQueue()},transferQueue:function(e){for(var t=this;_taq.length;){var n=_taq.shift();if("create"==n[0])A="accounter",c=n[1]||"",u=n[2]||"",c||console.log("error: accountId is null"),u||console.log("error: domain is null");else if("trackinit"==n[0])l=n[1]||"",f=n[2]||"",customSteps=n[3]||"",customSteps&&!isNaN(customSteps-0)&&(v=customSteps-0),l||console.log("error: device is null"),f||console.log("error: app is null");else if("trackevent"==n[0]){var r=n[1]||"",o=n[2]||"",a=n[3]||"",i=n[4]||"",s=n[5]||"";r||console.log("error: page is null"),o||console.log("error: etype is null"),a||console.log("error: concrete is null"),"pv"==o&&(S=!0),"pv"==o||i||console.log("error: target is null");var d={page:r,event_type:o,concrete:a,option:s};if(i){var g=t.getPosition(i);Q.extend(d,g)}T.push(d)}else"debug"==n[0]?C=!0:console.log("push type error")}return e?void this.consumeQueue():void(T.length>=v?this.consumeQueue():C&&console.log("left_info: "+JSON.stringify(T)+"\nlength: "+T.length))},consumeQueue:function(){var e=T.length;if(!(0>=e)){var t=this.getDeviceInfo(),n=JSON.stringify(T);if(n.length<h)Q.extend(t,{track_data:n}),t.ad_id=Q.getAdId(),this.sendLog(t),T=[];else{for(var r=[];T.length;){var o=T.shift();r.push(o);var a=JSON.stringify(r);a.length>h&&(Q.extend(t,{track_data:a}),t.ad_id=Q.getAdId(),this.sendLog(t),r=[])}r.length&&(Q.extend(t,{track_data:JSON.stringify(r)}),t.ad_id=Q.getAdId(),this.sendLog(t))}}},sendLog:function(e){var t={advertiser:"http://isub.snssdk.com/2/wap/landing_page_log/",accounter:"http://isub.snssdk.com/api/2/wap/account_log/"};Q.jsonp({url:t[A],callback:"callback",data:e,success:function(){console.log("send log success")},fail:function(){console.log("send log fail")}})},doConsume:function(e){y=!0,clearTimeout(p),"success"==e?this.transferQueue():"timeout"==e?this.transferQueue():console.log("getAppInfo fail")},getPerformance:function(){_=!0,d=q.getPerformanceObj()},sendPerformance:function(){var e=this.getDeviceInfo();Q.extend(e,d),e.dom_count=q.getDomCount(),e.ad_id=Q.getAdId()},getDeviceInfo:function(){var e={};return c&&(e.account_id=c),u&&(e.domain=u),l&&(e.device=l),f&&(e.app=f),g&&(e.device_id=g),m&&(e.user_id=m),e},getPosition:function(t){if(t){var n=e.innerWidth||document.body.clientWidth,r=t.offsetLeft,o=t.offsetHeight,a=320,i=q.getElementParents(t),s={ox:r,oy:o,tx:~~(r*a/n),ty:~~(o*a/n),xpath:q.getXPath(i)};return s}}};q.delegate(document,"onmousedown","[tt-data-click]",function(){$target=this;var e=$target.getAttribute("tt-data-click");e.indexOf("etype")||(e+="&etype=click"),C&&console.log("click_info: "+e),L.send(Q.queryToJson(e))}),_taq.pushListener=L.transferQueue;var B=_taq.push;_taq.push=function(){B.apply(this,arguments),"function"==typeof this.pushListener&&y&&this.pushListener.call(L)},r(),Q.isToutiao()&&P({success:function(e){"string"==typeof e&&(e=JSON.parse(e)),g=e.device_id||"",m=e.user_id||"",L.doConsume("success")},fail:function(){L.doConsume("fail")},error:function(){L.doConsume("error")}}),p=setTimeout(function(){L.doConsume("timeout")},1500),e.onbeforeunload=function(){if(S)L.transferQueue(!0);else{var e=q.getElementByAttr(document,"tt-data-view"),t="";t=e.length?e[0].getAttribute("tt-data-view"):document.title,_taq.push(["trackevent",location.href,"pv","","",{title:t}])}},e.ta={send:L.send}}(window,document);